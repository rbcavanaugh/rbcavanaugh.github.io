---
title: "{distill} + {pagedown} + {datadrivencv}"
description: |
  A hackish method of updating a distill personal webpage and CV at the same time
author:
  - name: Rob Cavanaugh
    url: {}
date: 04-18-2021
output:
  distill::distill_article:
    self_contained: false
draft: true
---

## Introduction

I recently needed to update my CV, which I always dread doing (half because I'm a PhD student with
very little on it and half because its just not a fun process). I finally put in the work to tweak
[NickStrayers'](https://twitter.com/nicholasstrayer/) super useful [{datadrivencv}](http://nickstrayer.me/datadrivencv/) package to be a
little more academic CV friendly. Mostly, this just entailed adding a few options to the `print_section()`
function in *cv_printing_functions.R* so that the publications/presentations entered into the CV didn't take up so much space using the {pagedown} preset formatting. 

Anyhow, I've also been wanting to be able to update my CV and website at the same time. Updating them separately is a pain and usually just means they're even more likely to be out of date...because neither one is terribly high on my priority list.

End setup = {distill} + {pagedown} + {datadrivencv} + a little bash code



## Here's a quick run down of what I did. 

### Get the CV structure setup

I ran `datadrivencv::use_datadriven_cv()` in a sub-folder of my distill website directory called "CV," and updated the code so that my CV was formatted. I had already done this, so for me just a matter of copying files over. But the instructions are pretty straightforward. For the uninformed: this package uses a google doc and some fancy {glue} code to populate information in a CV.

### Add cv.html to my distill website yml

I doubt this fits the intended use-cases for distill, but I didn't even make an .Rmd file for cv.html (I tried, but I couldn't get pagedown to play nice with distill...it would make this process even faster).

When you run `use_datadriven_cv()`, there's an Rscript created called *render_cv.r*. I simply tweaked this script so that it would 1) render my website 2) render my cv as an html **and** save the .html file in the _site folder of the distill directory so that it would be included on the website 3) convert that .html file to a pdf for downloading.

```{r eval = FALSE}
rmarkdown::render_site(encoding = 'UTF-8')

library(here)
# Knit the HTML version
rmarkdown::render(here("CV", "cv.rmd"),
                  #params = list(pdf_mode = FALSE),
                  output_file = "~/.../personal-website-distill/_site/cv.html")

# Convert to PDF using Pagedown
pagedown::chrome_print(input = "~/.../personal-website-distill/_site/cv.html",
                       output = here("CV", "cv.pdf"))
```


### Add some CV content to my website

I know a lot of people have a long dedicated research page (where this might be even more helpful) but I just wanted to list a couple of publications and presentations on my main page. To accomplish this, I added a new column to the google doc created for my CV with a TRUE/FALSE variable. Then I saved a new copy of the *cv_printing_functions.r* script in a new 'R' folder in my website directory and made two minor tweaks:

1. I filtered the data from the CV to only include rows with a TRUE value in my new column

```{r eval = FALSE}
  # Clean up entries dataframe to format we need it for printing
  cv$entries_data %<>%
    dplyr::filter(in_website=="TRUE") %>%
    
```

2. I slightly modified the `print_section` function to just print out the title. This just fits how I modified the google doc for my CV and could be tailored to just about anything, which is the beauty of the datadrivencv code. 

```{r eval = FALSE}
print_section <- function(cv, section_id, glue_template = "article"){

  if(glue_template == "article"){
    # modify here! glue template is how your spreadsheet data will be spit out in your rmarkdown doc
    glue_template <- "
{title}
\n\n\n"
  } else if(glue_template == "poster"){
    # I did this one for posters...eventually I'll want to link them separately...
    glue_template <- "
[{title}]
\n\n\n"
  }

  section_data <- dplyr::filter(cv$entries_data, section == section_id)

  for(i in 1:nrow(section_data)){
    for(col in c('title', 'description_bullets')){
      strip_res <- sanitize_links(cv, section_data[i, col])
      section_data[i, col] <- strip_res$text
      cv <- strip_res$cv
    }
  }

  print(glue::glue_data(section_data, glue_template))

  invisible(strip_res$cv)
}
```

3. Now I can just print the publications or presentations on my home website page like so: 

```{r results='asis', eval = FALSE}
# Note the special double pipe so we modify the CV object in place
CV %<>% print_section("publications") 

```


### Putting it all together

This all seemed great, but it required me to 1) render my website 2) render my CV to save the cv.html file in the _site folder 3) push the changes to github so that they rendered on Netlify. Admittedly this was better than when I had them in separate repositories, but was still a bit annoying. So I added `rmarkdown::render_site(encoding = 'UTF-8')` to my *render_cv.r* script before the CV gets rendered and cobbled together a bash function to update everything at once and added it to my .bash_profile. 

```{r eval = FALSE}
update_website () { 
    Rscript CV/render_cv.r;
    git pull;
    git add .;
    git commit -a -m "$1";
    git push
}
```

1. open temrinal and type nano .bash_profile
2. paste function
3. hit ctrl+x
4. Y to save
5. Close terminal
6. In Rstudio, open terminal and write update_website "whatever commit message you want" and poof everything is updated. 

### New update CV and website workflow

1. add row with information to spreadsheet
2. open R project
3. update_website "message"

done!


